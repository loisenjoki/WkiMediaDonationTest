<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width initial-scale=1.0" />

  <title>Wikimedia Foundation Task</title>
  <link rel="stylesheet" href="stylesheets/style.css" />

</head>
<body>
  <div id="app">
    <form id="form">
      <h2 class="primary-header">Donation Form</h2>
      <!-- First and Last Name -->
      <div class="container">
        <p>fill in all the required fields</p>
        <div>
          <label for="first-name">First Name</label><span style="color: red;"> * </span><br/>
          <input type="text" id="first-name" name="first-name" class="form-control" required/>
        </div>
        <div>
          <label for="last-name">Last Name</label><span style="color: red;"> * </span><br/>
          <input type="text" id="last-name" name="last-name" class="form-control" required/>
        </div>
      </div>

      <!-- Street Address -->
      <label for="street-address">Street Address</label><span style="color: red;"> * </span><br/>
      <input type="text" id="street-address" name="street-address" class="form-control" required/>

      <!-- City, State/Region, and Postal Code -->
      <div class="city-state-container">
        <div>
          <label for="city">City</label><span style="color: red;"> * </span><br/>
          <input type="text" id="city" name="city" style="max-width: 100%;" class="form-control" required/>
        </div>
        <div>
          <label for="state-region">State/Region</label><span style="color: red;"> * </span><br/>
          <input type="text" id="state-region" name="state-region" style="max-width: 100%;" class="form-control" required/>
        </div>
        <div>
          <label for="postal-code">Postal Code</label><span style="color: red;"> * </span><br/>
          <input type="text" id="postal-code" name="postal-code" style="max-width: 100%;" class="form-control" required/>
        </div>
      </div>

      <!-- country -->
      <label for="country">Country</label><span style="color: red;"> * </span><br/>
      <!-- error with select tag's size attribute and onchange event when trying to reselect the same value -->
      <select id="country" name="country" onmousedown="if(this.options.length>8){this.size=8;}" onchange="this.size=0;" onblur="this.size=0;">
        <!--<option value="0">&#45;&#45; Select Country &#45;&#45;</option>-->
        <option value="1">Afghanistan</option><option value="2"> Albania</option><option value="3">Algeria</option><option value="4">Andorra</option><option value="5">Angola</option><option value="6">Antigua & Deps</option><option value="7">Argentina</option><option value="8">Armenia</option><option value="9">Australia</option><option value="10">Austria</option><option value="11">Azerbaijan</option><option value="12">Bahamas</option><option value="13">Bahrain</option><option value="14">Bangladesh</option><option value="15">Barbados</option><option value="16">Belarus</option><option value="17">Belgium</option><option value="18">Belize</option><option value="19">Benin</option><option value="20">Bhutan</option><option value="21">Bolivia</option><option value="22">Bosnia Herzegovina</option><option value="23">Botswana</option><option value="24">Brazil</option><option value="25">Brunei</option><option value="26">Bulgaria</option><option value="27">Burkina</option><option value="28">Burundi</option><option value="29">Cambodia</option><option value="30">Cameroon</option><option value="31">Canada</option><option value="32">Cape Verde</option><option value="33">Central African Rep</option><option value="34">Chad</option><option value="35">Chile</option><option value="36">China</option><option value="37">Colombia</option><option value="38">Comoros</option><option value="39">Congo</option><option value="40">Congo {Democratic Rep}</option><option value="41">Costa Rica</option><option value="42">Croatia</option><option value="43">Cuba</option><option value="44">Cyprus</option><option value="45">Czech Republic</option><option value="46">Denmark</option><option value="47">Djibouti</option><option value="48">Dominica</option><option value="49">Dominican Republic</option><option value="50">East Timor</option><option value="51">Ecuador</option><option value="52">Egypt</option><option value="53">El Salvador</option><option value="54">Equatorial Guinea</option><option value="55">Eritrea</option><option value="56">Estonia</option><option value="57">Ethiopia</option><option value="58">Fiji</option><option value="59">Finland</option><option value="60">France</option><option value="61">Gabon</option><option value="62">Gambia</option><option value="63">Georgia</option><option value="64">Germany</option><option value="65">Ghana</option><option value="66">Greece</option><option value="67">Grenada</option><option value="68">Guatemala</option><option value="69">Guinea</option><option value="70">Guinea-Bissau</option><option value="71">Guyana</option><option value="72">Haiti</option><option value="73">Honduras</option><option value="74">Hungary</option><option value="75">Iceland</option><option value="76">India</option><option value="77">Indonesia</option><option value="78">Iran</option><option value="79">Iraq</option><option value="80">Ireland {Republic}</option><option value="81">Israel</option><option value="82">Italy</option><option value="83">Ivory Coast</option><option value="84">Jamaica</option><option value="85">Japan</option><option value="86">Jordan</option><option value="87">Kazakhstan</option><option value="88">Kenya</option><option value="89">Kiribati</option><option value="90">Korea North</option><option value="91">Korea South</option><option value="92">Kosovo</option><option value="93">Kuwait</option><option value="94">Kyrgyzstan</option><option value="95">Laos</option><option value="96">Latvia</option><option value="97">Lebanon</option><option value="98">Lesotho</option><option value="99">Liberia</option><option value="100">Libya</option><option value="101">Liechtenstein</option><option value="102">Lithuania</option><option value="103">Luxembourg</option><option value="104">Macedonia</option><option value="105">Madagascar</option><option value="106">Malawi</option><option value="107">Malaysia</option><option value="108">Maldives</option><option value="109">Mali</option><option value="110">Malta</option><option value="111">Marshall Islands</option><option value="112">Mauritania</option><option value="113">Mauritius</option><option value="114">Mexico</option><option value="115">Micronesia</option><option value="116">Moldova</option><option value="117">Monaco</option><option value="118">Mongolia</option><option value="119">Montenegro</option><option value="120">Morocco</option><option value="121">Mozambique</option><option value="122">Myanmar, {Burma}</option><option value="123">Namibia</option><option value="124">Nauru</option><option value="125">Nepal</option><option value="126">Netherlands</option><option value="127">New Zealand</option><option value="128">Nicaragua</option><option value="129">Niger</option><option value="130">Nigeria</option><option value="131">Norway</option><option value="132">Oman</option><option value="133">Pakistan</option><option value="134">Palau</option><option value="135">Panama</option><option value="136">Papua New Guinea</option><option value="137">Paraguay</option><option value="138">Peru</option><option value="139">Philippines</option><option value="140">Poland</option><option value="141">Portugal</option><option value="142">Qatar</option><option value="143">Romania</option><option value="144">Russian Federation</option><option value="145">Rwanda</option><option value="146">St Kitts & Nevis</option><option value="147">St Lucia</option><option value="148">Saint Vincent & the Grenadines</option><option value="149">Samoa</option><option value="150">San Marino</option><option value="151">Sao Tome & Principe</option><option value="152">Saudi Arabia</option><option value="153">Senegal</option><option value="154">Serbia</option><option value="155">Seychelles</option><option value="156">Sierra Leone</option><option value="157">Singapore</option><option value="158">Slovakia</option><option value="159">Slovenia</option><option value="160">Solomon Islands</option><option value="161">Somalia</option><option value="162">South Africa</option><option value="163">South Sudan</option><option value="164">Spain</option><option value="165">Sri Lanka</option><option value="166">Sudan</option><option value="167">Suriname</option><option value="168">Swaziland</option><option value="169">Sweden</option><option value="170">Switzerland</option><option value="171">Syria</option><option value="172">Taiwan</option><option value="173">Tajikistan</option><option value="174">Tanzania</option><option value="175">Thailand</option><option value="176">Togo</option><option value="177">Tonga</option><option value="178">Trinidad & Tobago</option><option value="179">Tunisia</option><option value="180">Turkey</option><option value="181">Turkmenistan</option><option value="182">Tuvalu</option><option value="183">Uganda</option><option value="184">Ukraine</option><option value="185">United Arab Emirates</option><option value="186">United Kingdom</option><option value="187">United States</option><option value="188">Uruguay</option><option value="189">Uzbekistan</option><option value="190">Vanuatu</option><option value="191">Vatican City</option><option value="192">Venezuela</option><option value="193">Vietnam</option><option value="194">Yemen</option><option value="195">Zambia</option><option value="196">Zimbabwe</option>
      </select>

      <!-- Email and Phone Number -->
      <div class="contact-container">
        <div>
          <label for="email">Email</label><span style="color: red;"> * </span><br/>
          <input type="email" id="email" name="email" class="form-control" required/>
        </div>
        <div>
          <label for="phone">Phone Number</label><span style="color: red;"> * </span><br/>
          <input type="text" id="phone" name="phone" class="form-control" required/>
        </div>
      </div>

      <!-- Preferred form of contact -->
      <label for="preferred-contact">Preferred Form of Contact</label><span style="color: red;"> * </span><br/>
      <select id="preferred-contact" name="preferred-contact" class="form-control" required>
        <option value="1">Phone</option><option value="2">Email</option>
      </select><br/>

      <!-- Preferred form of payment -->
      <label for="preferred-payment">Preferred Form of Payment</label><span style="color: red;"> * </span><br/>
      <select id="preferred-payment" name="preferred-payment" class="form-control" required>
        <option value="1">USD</option><option value="2">Euro</option><option value="2">Bitcoin</option>
      </select><br/>

      <!-- Frequency of donation -->
      <label for="donation-frequency">Frequency of Donation</label><span style="color: red;"> * </span><br/>
      <select id="donation-frequency" name="donation-frequency">
        <option value="1">Monthly</option><option value="1">Yearly</option><option value="1">One-time</option>
      </select><br/>

      <!-- Amount of donation -->
      <label for="donation-amount">Amount of Donation</label><span style="color: red;"> * </span><br/>
      <input type="number" id="donation-amount" name="donation-amount" class="form-control" required/><br/>

      <!-- Comments -->
      <label for="comments">Comments</label><br/>
        <textarea id="comments" name="comments" rows="4" class="form-control"></textarea>

      <!-- Review Button -->
      <div class="btn-container">
        <button id="review" type="button" onclick="checkInformation()">Review</button>
      </div>

    </form>

    <form>
      <input id="editmail" hidden type = "button" value = "Edit your Donation" onclick = "editinfo();" />
    </form>

    <script type="text/javascript">
      var editing = sessionStorage.getItem('edit');
      if(editing==='yes'){
        var fdata = JSON.parse(sessionStorage.getItem('mydata'))
        document.getElementById('first-name').value = fdata.first_name;
        document.getElementById('last-name').value = fdata.last_name;
        document.getElementById('street-address').value = fdata.street_address;
        document.getElementById('city').value = fdata.city;
        document.getElementById('state-region').value = fdata.state_region;
         document.getElementById('postal-code').value = fdata. postal_code;
         document.getElementById('email').value = fdata.email;
         document.getElementById('phone').value = fdata. phone_number;
         document.getElementById('donation-amount').value = fdata.donation_amount;
         document.getElementById('comments').value = fdata.comments;

      }

      let myObj = {
        first_name: '',
        last_name: '',
        street_address: '',
        city: '',
        state_region: '',
        country: '',
        postal_code: '',
        phone_number: 0,
        email: '',
        preferred_contact: '',
        preferred_payment: '',
        donation_frequency: '',
        donation_amount: 0.00,
        comments: ''
      };

      function checkInformation() {
        if (validateForm()) {
       window.location = "confirmation.html";
       sessionStorage.setItem('edit','no');
        }
      }
      //edit user info using id
      function editinfo() {
        const retVal = prompt("Enter your email Address : ", "test@gmail.com");
          sessionStorage.setItem('emailaddress', retVal);
        fetch(`/singledonor`, {
          method: 'GET',
        //  qs: {email:retVal},
          headers: {
            'Content-type': 'application/json; charset=UTF-8'
          }
        }).then(res => res.json())
                .then(res => {console.log(JSON.stringify(res))
                  sessionStorage.setItem('mydata', JSON.stringify(res));
                  sessionStorage.setItem('edit','yes')
                  window.location.reload();

                })
                .catch(function (res) {
                  console.log(+res)
                });
          sessionStorage.setItem('edit','yes');

      }

      function validateForm() {
        const first_name = document.getElementById('first-name');
        const last_name = document.getElementById('last-name');
        const street_address = document.getElementById('street-address');
        const city = document.getElementById('city');
        const state_region = document.getElementById('state-region');
        const postal_code = document.getElementById('postal-code');
        const country = document.getElementById('country');
        const email = document.getElementById('email');
        const phone = document.getElementById('phone');
        const preferred_contact = document.getElementById('preferred-contact');
        const preferred_payment = document.getElementById('preferred-payment');
        const donation_frequency = document.getElementById('donation-frequency');
        const donation_amount = document.getElementById('donation-amount');
        const comments = document.getElementById('comments');
        if (isEmpty(first_name.value.trim())) {
          alert('First name is required!');
          return false;
        }
        if (isEmpty(last_name.value.trim())) {
          alert('Last name is required!');
          return false;
        }
        if (isEmpty(street_address.value.trim())) {
          alert('Street Address is required!');
          return false;
        }
        if (isEmpty(city.value.trim())) {
          alert('City is required!');
          return false;
        }
        if (isEmpty(state_region.value.trim())) {
          alert('State/Region is required!');
          return false;
        }
        if (isEmpty(postal_code.value.trim())) {
          alert('Postal Code is required!');
          return false;
        }
        if (isEmpty(email.value.trim())) {
          alert('Email is required!');
          return false;
        }
        if (!validateEmail(email.value.trim())) {
          alert('Email must be a valid email address!');
          return false;
        }
        if (isEmpty(phone.value.trim())) {
          alert('Phone Number is required!');
          return false;
        }
        if (isEmpty(preferred_contact.value.trim())) {
          alert('Please select your preferred form of contact.');
          return false;
        }
        if (isEmpty(preferred_payment.value.trim())) {
          alert('Please select your preferred form of payment.');
          return false;
        }
        if (isEmpty(donation_frequency.value.trim())) {
          alert('Please select a frequency of donation.');
          return false;
        }
        if (isEmpty(donation_amount.value.trim())) {
          alert('Please enter the amount of donation.');
          return false;
        }
        if (country && country.options[country.selectedIndex].value === 0) {
          alert('Country is required!');
          return false;
        }
        myObj = {...myObj, first_name: first_name.value, last_name: last_name.value, street_address: street_address.value, city: city.value, state_region: state_region.value,
          postal_code: postal_code.value, country: country.selectedOptions[0].innerHTML, email: email.value, phone_number: phone.value, preferred_contact: preferred_contact.selectedOptions[0].innerHTML, 
          preferred_payment: preferred_payment.selectedOptions[0].innerHTML, donation_frequency: donation_frequency.selectedOptions[0].innerHTML, donation_amount: donation_amount.value, comments: comments.value};

        sessionStorage.setItem('mydata', JSON.stringify(myObj));

        return true;
      }

      function isEmpty(str) { return (str.length === 0 || !str.trim()); }

      function validateEmail(email) {
        let re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,15}(?:\.[a-z]{2})?)$/i;
        return isEmpty(email) || re.test(email);
      }
    </script>

  </div>

</body>

</html>
